---
title: "PHPMailer的使用"
categories: php  
tags: php mail
---

成功的关键是引入的时候要引入全。。。

已经修改完善在tsy组件里面了，下面是一个成功的测试版

可以参考这个完成邮件发送

但是貌似要php开启了socket
<pre style="background-color:#2b2b2b;color:#a9b7c6;font-family:'宋体';font-size:16.5pt;"><span style="color:#cc7832;background-color:#232525;font-weight:bold;">&lt;?php
</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">require </span><span style="color:#6a8759;background-color:#232525;">'PHPMailer/class.phpmailer.php'</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">require </span><span style="color:#6a8759;background-color:#232525;">'PHPMailer/PHPMailerAutoload.php'</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">function </span><span style="color:#ffc66d;background-color:#232525;">smtp_mail</span><span style="background-color:#232525;">( </span><span style="color:#9876aa;background-color:#40332b;">$sendto_email</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$subject</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$body</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$extra_hdrs</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$user_name</span><span style="background-color:#232525;">){
</span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail </span><span style="background-color:#232525;">= </span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">new </span><span style="background-color:#232525;">PHPMailer()</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#ffc66d;background-color:#232525;">IsSMTP</span><spanstyle="background-color:#232525;">()<span style="color:#cc7832;background-color:#232525;">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#808080;background-color:#232525;">// send via SMTP
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Host </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"smtp.163.com"</span><span style="color:#cc7832;background-color:#232525;">; &nbsp; </span><span style="color:#808080;background-color:#232525;">//SMTP servers
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">SMTPAuth</span><span style="background-color:#232525;">= </span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">true</span><span style="color:#cc7832;background-color:#232525;">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color:#808080;background-color:#232525;">// turn on SMTP authentication
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Username </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"xxxx@163.com"</span><span style="color:#cc7832;background-color:#232525;">; &nbsp; &nbsp; </span><span style="color:#808080;background-color:#232525;">// SMTP username &nbsp;注意：普通邮件认证不需要加 @域名
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Password </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"xxxxx"</span><span style="color:#cc7832;background-color:#232525;">; </span><span style="color:#808080;background-color:#232525;">// SMTP password
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">From </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"xxxxx@163.com"</span><span style="color:#cc7832;background-color:#232525;">; &nbsp; &nbsp; &nbsp;</span><span style="color:#808080;background-color:#232525;">// 发件人邮箱
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">FromName </span><span style="background-color:#232525;">= &nbsp;</span><span style="color:#6a8759;background-color:#232525;">"shadow"</span><span style="color:#cc7832;background-color:#232525;">; &nbsp;</span><span style="color:#808080;background-color:#232525;">// 发件人
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">CharSet </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"UTF-8"</span><span style="color:#cc7832;background-color:#232525;">; &nbsp; </span><span style="color:#808080;background-color:#232525;">// 这里指定字符集！
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Encoding </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"base64"</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#ffc66d;background-color:#232525;">AddAddress</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#344134;">$sendto_email</span><span style="color:#cc7832;background-color:#232525;">,</span><span style="color:#6a8759;background-color:#232525;">"username"</span><span style="background-color:#232525;">)</span><span style="color:#cc7832;background-color:#232525;">; &nbsp;</span><span style="color:#808080;background-color:#232525;">// 收件人邮箱和姓名
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#ffc66d;background-color:#232525;">AddReplyTo</span><span style="background-color:#232525;">(</span><span style="color:#6a8759;background-color:#232525;">"xxxx@163.com"</span><span style="color:#cc7832;background-color:#232525;">,</span><span style="color:#6a8759;background-color:#232525;">"收件人姓名"</span><span style="background-color:#232525;">)</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#808080;background-color:#232525;">//$mail-&gt;WordWrap = 50; // set word wrap 换行字数
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;//$mail-&gt;AddAttachment("/var/tmp/file.tar.gz"); // attachment 附件
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;//$mail-&gt;AddAttachment("/tmp/image.jpg", "new.jpg");
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#ffc66d;background-color:#232525;">IsHTML</span><span style="background-color:#232525;">(</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">true</span><span style="background-color:#232525;">)</span><span style="color:#cc7832;background-color:#232525;">; &nbsp;</span><span style="color:#808080;background-color:#232525;">// send as HTML
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;// 邮件主题
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Subject </span><span style="background-color:#232525;">= </span><span style="color:#9876aa;background-color:#232525;">$subject</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#808080;background-color:#232525;">// 邮件内容
</span><span style="color:#808080;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">Body </span><span style="background-color:#232525;">= </span><span style="color:#6a8759;background-color:#232525;">"发送内容测试"</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">if</span><span style="background-color:#232525;">(!</span><span style="color:#9876aa;background-color:#232525;">$mail</span><spanstyle="background-color:#232525;">-&gt;<span style="color:#ffc66d;background-color:#232525;">Send</span><span style="background-color:#232525;">())
</span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;{
</span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">echo </span><span style="color:#6a8759;background-color:#232525;">"邮件发送有误 &lt;p&gt;"</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">echo </span><span style="color:#6a8759;background-color:#232525;">"邮件错误信息: " </span><span style="background-color:#232525;">. </span><span style="color:#9876aa;background-color:#232525;">$mail</span><span style="background-color:#232525;">-&gt;</span><span style="color:#9876aa;background-color:#232525;">ErrorInfo</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">exit</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#232525;">}
</span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">else </span><span style="background-color:#232525;">{
</span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">echo </span><span style="color:#6a8759;background-color:#232525;">"</span><span style="color:#9876aa;background-color:#232525;">$user_name</span><span style="color:#6a8759;background-color:#232525;"> 邮件发送成功!&lt;br /&gt;"</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#232525;">}
</span><span style="background-color:#232525;"> &nbsp; &nbsp;}
</span><span style="color:#808080;background-color:#232525;">// 参数说明(发送到, 邮件主题, 邮件内容, 附加信息, 用户名)
</span><span style="background-color:#232525;">smtp_mail(</span><span style="color:#6a8759;background-color:#232525;">"xxxx@qq.com"</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#6a8759;background-color:#232525;">"欢迎使用phpmailer！"</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#6a8759;background-color:#232525;">"NULL"</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#6a8759;background-color:#232525;">"yourdomain.com"</span><span style="color:#cc7832;background-color:#232525;">, </span><span style="color:#6a8759;background-color:#232525;">"username"</span><span style="background-color:#232525;">)</span><span style="color:#cc7832;background-color:#232525;">;
</span><span style="color:#cc7832;background-color:#232525;font-weight:bold;">?&gt;</span></spanstyle="background-color:#232525;"></spanstyle="background-color:#232525;"></pre>

&nbsp;&nbsp;
